# YOLOv5 自动分类系统

一个基于YOLOv5模型的智能图像分类和文件整理系统，采用模块化设计，代码结构清晰，易于维护和扩展。

## 🏗️ 项目结构

```
choose/
├── main.py                 # 主程序入口
├── image_classifier.py     # 图像分类器主类
├── model_manager.py        # 模型管理模块
├── file_scanner.py         # 文件扫描模块
├── file_processor.py       # 文件处理模块
├── config.py              # 配置文件
├── utils.py               # 工具函数
├── requirements.txt        # 依赖包
└── README.md              # 项目说明
```

## 🔧 模块说明

### 1. **main.py** - 主程序入口
- 程序启动入口
- 用户交互逻辑
- 错误处理和程序流程控制

### 2. **image_classifier.py** - 图像分类器主类
- 整合所有功能模块
- 协调各模块之间的工作流程
- 提供统一的对外接口
- 显示详细的目录结构统计
- 智能分析目录结构

### 3. **model_manager.py** - 模型管理模块
- ONNX模型加载和初始化
- GPU/CPU自动切换
- 图像预处理和推理

### 4. **file_scanner.py** - 文件扫描模块
- 智能扫描根目录下的子目录
- 在每个子目录中查找EPCData文件夹
- 支持多种图片格式
- 提供目录结构分析功能

### 5. **file_processor.py** - 文件处理模块
- 文件复制和分类逻辑
- 智能解析文件夹名称
- 自动创建新的目录结构
- cuboid文件夹同步

### 6. **config.py** - 配置文件
- 集中管理所有配置参数
- 易于修改和维护
- 支持不同环境配置

### 7. **utils.py** - 工具函数
- 通用辅助功能
- 进度跟踪器
- 时间和文件大小格式化

## 🚀 使用方法

1. **安装依赖**
   ```bash
   pip install -r requirements.txt
   ```

2. **准备模型文件**
   - 将 `gpu.onnx` 模型文件放在项目根目录

3. **运行程序**
   ```bash
   python main.py
   ```

4. **输入目录路径**
   - 输入包含多个子目录的根目录路径
   - 每个子目录下应该包含EPCData文件夹
   - 程序将自动处理所有符合条件的图片

## 📁 目录结构要求

### **输入目录结构**
您的根目录应该包含多个子目录，每个子目录下有EPCData文件夹：

```
根目录/
├── 目录1/           # 包含EPCData的目录
│   └── EPCData/
│       └── 00000010-2025-06-21-10-41-09-066/
│           └── basicPoint.jpg
├── 目录2/           # 包含EPCData的目录
│   └── EPCData/
│       └── 00000101-2025-06-22-13-57-51-584/
│           └── basicPoint.jpg
└── 目录3/           # 包含EPCData的目录
    └── EPCData/
        └── 000000123-2025-06-23-14-30-15-789/
            └── basicPoint.jpg
```

### **智能文件夹解析**
程序会自动解析文件夹名称格式，支持不同位数的耳号：

#### **支持的耳号格式**
- `00000010-2025-06-21-10-41-09-066` → 耳号: 10
- `00000101-2025-06-22-13-57-51-584` → 耳号: 101  
- `000000123-2025-06-23-14-30-15-789` → 耳号: 123
- `0000001-2025-06-24-09-15-30-456` → 耳号: 1

#### **格式说明**
- **前导零 + 耳号**: 支持任意数量的前导零
- **2025-06-21**: 日期格式 (YYYY-MM-DD)
- **10-41-09**: 时间格式 (HH-MM-SS)
- **066**: 序列号

### **分类后的目录结构**
```
score/
├── 2025-06-21/                    # 日期
│   ├── 10/                        # 耳号
│   │   ├── 80/                    # 分数区间(80-89)
│   │   │   └── 00000010-2025-06-21-10-41-09-066/  # 具体文件夹
│   │   └── cuboid/                # cuboid数据
│   └── 101/                       # 耳号101
│       ├── 90/                    # 分数区间(90-99)
│       │   └── 00000101-2025-06-22-13-57-51-584/
│       └── cuboid/
└── 2025-06-23/                    # 另一个日期
    └── 123/                       # 耳号123
        ├── 70/                    # 分数区间(70-79)
        │   └── 000000123-2025-06-23-14-30-15-789/
        └── cuboid/
```

### **分数分类规则**
- 置信度 0.0-0.09 → undetected (未检测到)
- 置信度 0.1-0.19 → 10
- 置信度 0.2-0.29 → 20
- ...以此类推
- 置信度 0.9-1.0 → 90

## ✨ 重构优势

### **模块化设计**
- 每个模块职责单一，易于理解和维护
- 模块间耦合度低，便于独立测试和修改
- 支持功能扩展和定制

### **智能文件组织**
- 自动解析文件夹名称中的日期和耳号信息
- 按照逻辑层次组织文件结构
- 支持多种命名格式的扩展
- 智能扫描多层目录结构
- 支持任意位数的耳号（自动去除前导零）

### **代码复用**
- 通用功能抽象为工具函数
- 配置参数集中管理
- 减少重复代码

### **可维护性**
- 清晰的代码结构和注释
- 统一的错误处理机制
- 便于调试和问题定位

### **可扩展性**
- 易于添加新的图片格式支持
- 可以轻松集成不同的AI模型
- 支持自定义分类规则和目录结构

## 🔍 核心功能

- **智能检测**: 使用YOLOv5模型自动检测图片中的目标
- **智能分类**: 根据检测置信度自动分类到不同分数文件夹
- **智能组织**: 自动解析文件夹名称，按日期、耳号、分数组织
- **智能扫描**: 自动识别多层目录结构，找到所有EPCData文件夹
- **智能解析**: 支持多种耳号格式，自动去除前导零
- **文件同步**: 自动复制相关文件夹和cuboid数据
- **进度跟踪**: 实时显示处理进度和剩余时间
- **结构统计**: 显示详细的目录结构统计信息
- **错误处理**: 完善的异常处理和用户提示

## 📝 注意事项

- 确保有足够的磁盘空间存储分类后的文件
- 模型文件 `gpu.onnx` 必须存在且有效
- 建议在处理大量文件前先备份原始数据
- 支持GPU加速，但CPU也能正常工作
- 文件夹名称必须符合指定格式才能正确解析
- 根目录下应该包含多个子目录，每个子目录下有EPCData文件夹
- 支持任意位数的耳号，程序会自动去除前导零

## 🤝 贡献

欢迎提交Issue和Pull Request来改进这个项目！
